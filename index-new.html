<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­æœªä¾†æ”¯å‡ºè¦åŠƒç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">å®¶åº­æœªä¾†æ”¯å‡ºè¦åŠƒç³»çµ±</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                å¹«åŠ©æ‚¨è¦åŠƒå®¶åº­æœªä¾†çš„é‡è¦æ”¯å‡ºï¼ŒåŒ…æ‹¬æ•™è‚²è²»ç”¨ã€çµå©šè²»ç”¨ç­‰ï¼Œä¸¦ç”¢å‡ºè©³ç´°çš„è¦åŠƒå ±å‘Š
            </p>
        </div>

        <!-- Planning Content -->
        <div id="planning-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                    </svg>
                    å®¶åº­æˆå“¡è¨­å®š
                </h2>
                
                <div id="family-members" class="space-y-4">
                    <!-- Family members will be added here -->
                </div>
                
                <button onclick="addFamilyMember()" class="mt-4 w-full bg-blue-50 hover:bg-blue-100 text-blue-700 font-medium py-2 px-4 rounded-md border border-blue-200 transition-colors">
                    + æ–°å¢å®¶åº­æˆå“¡
                </button>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    æœªä¾†æ”¯å‡ºè¦åŠƒ
                </h2>
                
                <div id="future-expenses" class="space-y-4">
                    <!-- Future expenses will be added here -->
                </div>
                
                <button onclick="addFutureExpense()" class="mt-4 w-full bg-green-50 hover:bg-green-100 text-green-700 font-medium py-2 px-4 rounded-md border border-green-200 transition-colors">
                    + æ–°å¢æœªä¾†æ”¯å‡ºé …ç›®
                </button>

                <!-- Summary -->
                <div id="summary" class="mt-8 p-4 bg-blue-50 rounded-lg hidden">
                    <h3 class="font-semibold text-lg mb-2">æ”¯å‡ºè¦åŠƒç¸½è¦½</h3>
                    <div class="text-2xl font-bold text-blue-600" id="total-amount">0 å…ƒ</div>
                    
                    <!-- Word å ±å‘ŠåŒ¯å‡ºæŒ‰éˆ• -->
                    <div class="mt-4 text-center">
                        <button onclick="exportToWord()" 
                                class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-md transition-colors flex items-center justify-center gap-2 mx-auto">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            åŒ¯å‡º Word å ±å‘Š
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                    </svg>
                    <h3 class="text-lg font-semibold">å®¶åº­æˆå“¡ç®¡ç†</h3>
                </div>
                <p class="text-gray-600">
                    æ–°å¢å’Œç®¡ç†å®¶åº­æˆå“¡è³‡è¨Šï¼ŒåŒ…æ‹¬å¹´é½¡å’Œé—œä¿‚ï¼Œç‚ºæ¯å€‹æˆå“¡è¦åŠƒå°ˆå±¬çš„æœªä¾†æ”¯å‡ºã€‚
                </p>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17h6l2 2H7l2-2zm-4-8a8 8 0 1116 0c0 2.5-5.5 6-8 6s-8-3.5-8-6z"></path>
                    </svg>
                    <h3 class="text-lg font-semibold">æ”¯å‡ºè¦åŠƒ</h3>
                </div>
                <p class="text-gray-600">
                    ç‚ºæ¯å€‹å®¶åº­æˆå“¡è¦åŠƒæœªä¾†çš„é‡è¦æ”¯å‡ºé …ç›®ï¼ŒåŒ…æ‹¬æ•™è‚²ã€çµå©šç­‰é‡å¤§äººç”Ÿäº‹ä»¶ã€‚
                </p>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="text-lg font-semibold">å ±å‘ŠåŒ¯å‡º</h3>
                </div>
                <p class="text-gray-600">
                    å°‡å®Œæ•´çš„æ”¯å‡ºè¦åŠƒçµæœåŒ¯å‡ºç‚º Word å ±å‘Šï¼Œæ–¹ä¾¿ä¿å­˜å’Œåˆ†äº«çµ¦å®¶äººè¨è«–ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        let familyMembers = [
            { id: '1', name: 'æˆ‘', currentAge: 45 },
            { id: '2', name: 'é…å¶', currentAge: 42 },
            { id: '3', name: 'é•·å­', currentAge: 15 },
            { id: '4', name: 'æ¬¡å¥³', currentAge: 12 }
        ];
        let futureExpenses = [];

        function addFamilyMember() {
            const id = Date.now().toString();
            const member = { id, name: '', currentAge: 0 };
            familyMembers.push(member);
            renderFamilyMembers();
        }

        function removeFamilyMember(id) {
            familyMembers = familyMembers.filter(member => member.id !== id);
            futureExpenses = futureExpenses.filter(expense => expense.familyMemberId !== id);
            renderFamilyMembers();
            renderFutureExpenses();
            updateSummary();
        }

        function updateFamilyMember(id, field, value) {
            const member = familyMembers.find(m => m.id === id);
            if (member) {
                member[field] = field === 'currentAge' ? parseInt(value) || 0 : value;
                renderFamilyMembers();
            }
        }

        function renderFamilyMembers() {
            const container = document.getElementById('family-members');
            container.innerHTML = familyMembers.map((member, index) => `
                <div class="flex items-center gap-4 p-4 border rounded-lg bg-gray-50">
                    <div class="flex-1 grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å§“å/é—œä¿‚</label>
                            <input type="text" value="${member.name}" 
                                   onchange="updateFamilyMember('${member.id}', 'name', this.value)"
                                   placeholder="ä¾‹å¦‚ï¼šæˆ‘ã€é…å¶ã€é•·å­"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç›®å‰å¹´é½¡</label>
                            <input type="number" value="${member.currentAge || ''}" 
                                   onchange="updateFamilyMember('${member.id}', 'currentAge', this.value)"
                                   placeholder="æ­²"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    ${index > 0 ? `
                        <button onclick="removeFamilyMember('${member.id}')" 
                                class="text-red-500 hover:text-red-700 p-2 rounded-md hover:bg-red-50">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        function addFutureExpense() {
            const id = Date.now().toString();
            const expense = {
                id,
                item: '',
                targetAge: 0,
                amount: 0,
                description: '',
                familyMemberId: familyMembers[0]?.id || ''
            };
            futureExpenses.push(expense);
            renderFutureExpenses();
        }

        function removeFutureExpense(id) {
            futureExpenses = futureExpenses.filter(expense => expense.id !== id);
            renderFutureExpenses();
            updateSummary();
        }

        function updateFutureExpense(id, field, value) {
            const expense = futureExpenses.find(e => e.id === id);
            if (expense) {
                if (field === 'targetAge' || field === 'amount') {
                    expense[field] = parseInt(value) || 0;
                } else {
                    expense[field] = value;
                }
                renderFutureExpenses();
                updateSummary();
            }
        }

        function renderFutureExpenses() {
            const container = document.getElementById('future-expenses');
            container.innerHTML = futureExpenses.map(expense => {
                const relatedMember = familyMembers.find(m => m.id === expense.familyMemberId);
                const yearsFromNow = relatedMember ? Math.max(0, expense.targetAge - relatedMember.currentAge) : 0;
                const monthlyAmount = yearsFromNow > 0 && expense.amount > 0 ? Math.round(expense.amount / (yearsFromNow * 12)) : 0;
                
                return `
                    <div class="p-4 border rounded-lg space-y-4 bg-gray-50">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ç›¸é—œæˆå“¡</label>
                                <select onchange="updateFutureExpense('${expense.id}', 'familyMemberId', this.value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    ${familyMembers.map(member => `
                                        <option value="${member.id}" ${expense.familyMemberId === member.id ? 'selected' : ''}>
                                            ${member.name} (${member.currentAge}æ­²)
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">æ”¯å‡ºé …ç›®</label>
                                <input type="text" value="${expense.item}" 
                                       onchange="updateFutureExpense('${expense.id}', 'item', this.value)"
                                       placeholder="ä¾‹å¦‚ï¼šå¤§å­¸å­¸è²»ã€çµå©šè²»ç”¨"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ç›®æ¨™å¹´é½¡ ${relatedMember ? `(${relatedMember.name})` : ''}</label>
                                <input type="number" value="${expense.targetAge || ''}" 
                                       onchange="updateFutureExpense('${expense.id}', 'targetAge', this.value)"
                                       placeholder="æ­²"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">é ä¼°é‡‘é¡</label>
                                <input type="number" value="${expense.amount || ''}" 
                                       onchange="updateFutureExpense('${expense.id}', 'amount', this.value)"
                                       placeholder="å…ƒ"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">è©³ç´°èªªæ˜</label>
                            <input type="text" value="${expense.description}" 
                                   onchange="updateFutureExpense('${expense.id}', 'description', this.value)"
                                   placeholder="è©³ç´°æè¿°é€™ç­†æ”¯å‡ºçš„ç”¨é€”å’Œé‡è¦æ€§"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        ${relatedMember && expense.targetAge > 0 ? `
                            <div class="text-sm text-blue-700 bg-blue-50 p-3 rounded">
                                <div class="font-medium mb-1">${relatedMember.name}çš„è¦åŠƒ</div>
                                <div class="grid grid-cols-2 gap-4">
                                    <span>è·é›¢ç›®æ¨™æ™‚é–“ï¼š${yearsFromNow}å¹´</span>
                                    ${monthlyAmount > 0 ? `<span>å»ºè­°æœˆå­˜ï¼š${monthlyAmount.toLocaleString()}å…ƒ</span>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        <button onclick="removeFutureExpense('${expense.id}')" 
                                class="text-red-500 hover:text-red-700 text-sm font-medium">
                            ğŸ—‘ï¸ åˆªé™¤æ­¤é …ç›®
                        </button>
                    </div>
                `;
            }).join('');
        }

        function updateSummary() {
            const total = futureExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const summaryDiv = document.getElementById('summary');
            const totalAmountDiv = document.getElementById('total-amount');
            
            if (total > 0) {
                summaryDiv.classList.remove('hidden');
                totalAmountDiv.textContent = total.toLocaleString() + ' å…ƒ';
            } else {
                summaryDiv.classList.add('hidden');
            }
        }

        // Word å ±å‘ŠåŒ¯å‡ºåŠŸèƒ½ - è¡¨æ ¼æ ¼å¼
        function exportToWord() {
            if (futureExpenses.length === 0) {
                alert('è«‹å…ˆæ–°å¢æ”¯å‡ºé …ç›®æ‰èƒ½åŒ¯å‡ºå ±å‘Š');
                return;
            }

            const currentDate = new Date().toLocaleDateString('zh-TW');
            const totalAmount = futureExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const currentYear = new Date().getFullYear();
            const yearColumns = [];
            for (let i = 0; i < 6; i++) {
                yearColumns.push(currentYear + i);
            }
            
            // æŒ‰æˆå“¡åˆ†çµ„
            const groupedExpenses = {};
            futureExpenses.forEach(expense => {
                if (!groupedExpenses[expense.familyMemberId]) {
                    groupedExpenses[expense.familyMemberId] = [];
                }
                groupedExpenses[expense.familyMemberId].push(expense);
            });

            // å»ºç«‹ HTML å…§å®¹ - è¡¨æ ¼æ ¼å¼
            let htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æœªä¾†å®¶åº­æ”¯å‡ºç›¤é»è¡¨</title>
    <style>
        body { 
            font-family: 'Microsoft JhengHei', 'SimHei', Arial, sans-serif; 
            margin: 30px; 
            line-height: 1.4; 
            color: #000;
            background-color: #fff;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .main-title { 
            font-size: 20px; 
            font-weight: bold; 
            margin-bottom: 15px;
            letter-spacing: 1px;
        }
        .info-line {
            text-align: right;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .main-table { 
            width: 100%; 
            border-collapse: collapse; 
            border: 2px solid #000;
            margin: 20px 0;
        }
        .main-table th, .main-table td { 
            border: 1px solid #000; 
            padding: 8px; 
            text-align: center;
            vertical-align: middle;
            font-size: 12px;
        }
        .main-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .member-header {
            background-color: #e8e8e8;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 40px;
        }
        .age-row {
            background-color: #f8f8f8;
            font-size: 11px;
        }
        .year-header {
            background-color: #d0d0d0;
            font-weight: bold;
            font-size: 14px;
        }
        .amount-cell {
            min-height: 25px;
            font-size: 11px;
        }
        .expense-item {
            background-color: #f9f9f9;
            font-weight: bold;
            text-align: left;
            padding-left: 10px;
        }
        .total-row {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        .notes {
            margin-top: 30px;
            font-size: 12px;
            line-height: 1.6;
        }
        .notes-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 10px;
            color: #666;
        }
        @media print {
            body { margin: 15px; }
            .main-table { font-size: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="main-title">æœªä¾†å®¶åº­æ”¯å‡ºç›¤é»è¡¨</div>
        <div class="info-line">å§“åï¼š_________________</div>
    </div>

    <table class="main-table">
        <thead>
            <tr>
                <th rowspan="2" class="member-header">æˆå“¡/å¹´é½¡</th>
                ${yearColumns.map(year => `<th class="year-header">${year}å¹´</th>`).join('')}
            </tr>
        </thead>
        <tbody>`;

            // å®¶åº­æˆå“¡å¹´é½¡è¡Œ
            familyMembers.forEach(member => {
                htmlContent += `
            <tr>
                <td class="member-header">${member.name}</td>
                ${yearColumns.map(year => {
                    const ageInYear = member.currentAge + (year - currentYear);
                    return `<td class="age-row">${ageInYear}æ­²</td>`;
                }).join('')}
            </tr>`;
            });

            // ç©ºè¡Œåˆ†éš”
            htmlContent += `
            <tr>
                <td class="member-header">å®¶<br>åº­<br>æˆ<br>å“¡</td>
                ${yearColumns.map(() => `<td class="age-row">æ­²</td>`).join('')}
            </tr>
            <tr>
                <td class="member-header"></td>
                ${yearColumns.map(() => `<td class="age-row">æ­²</td>`).join('')}
            </tr>
            <tr>
                <td class="member-header"></td>
                ${yearColumns.map(() => `<td class="age-row">æ­²</td>`).join('')}
            </tr>`;

            // æ”¯å‡ºé …ç›®æ¨™é¡Œè¡Œ
            htmlContent += `
            <tr>
                <td class="expense-item">é …ç›®</td>
                ${yearColumns.map(year => `<th class="year-header">${year}å¹´</th>`).join('')}
            </tr>`;

            // ç‚ºæ¯å€‹æ”¯å‡ºé …ç›®å‰µå»ºè¡Œ
            const allExpenseItems = [];
            futureExpenses.forEach(expense => {
                const member = familyMembers.find(m => m.id === expense.familyMemberId);
                if (member) {
                    const yearsFromNow = Math.max(0, expense.targetAge - member.currentAge);
                    const targetYear = currentYear + yearsFromNow;
                    allExpenseItems.push({
                        ...expense,
                        targetYear,
                        memberName: member.name
                    });
                }
            });

            // æŒ‰å¹´ä»½å’Œæˆå“¡æ’åº
            allExpenseItems.sort((a, b) => a.targetYear - b.targetYear || a.memberName.localeCompare(b.memberName));

            // æ·»åŠ æ”¯å‡ºé …ç›®è¡Œ
            const maxRows = Math.max(12, allExpenseItems.length + 3); // è‡³å°‘12è¡Œ
            for (let i = 0; i < maxRows; i++) {
                const expense = allExpenseItems[i];
                htmlContent += `
            <tr>
                <td class="expense-item">${expense ? `${expense.item} (${expense.memberName})` : ''}</td>
                ${yearColumns.map(year => {
                    if (expense && expense.targetYear === year) {
                        return `<td class="amount-cell">${expense.amount.toLocaleString()}</td>`;
                    }
                    return `<td class="amount-cell"></td>`;
                }).join('')}
            </tr>`;
            }

            // ç¸½è¨ˆè¡Œ
            htmlContent += `
            <tr class="total-row">
                <td class="expense-item">ç¸½è¨ˆ</td>
                ${yearColumns.map(year => {
                    const yearTotal = allExpenseItems
                        .filter(item => item.targetYear === year)
                        .reduce((sum, item) => sum + item.amount, 0);
                    return `<td class="amount-cell">${yearTotal > 0 ? yearTotal.toLocaleString() : ''}</td>`;
                }).join('')}
            </tr>`;

            htmlContent += `
        </tbody>
    </table>

    <div class="notes">
        <div class="notes-title">è¦åŠƒèªªæ˜ï¼š</div>
        <div>1. æœ¬è¡¨æ ¼ç”¨æ–¼è¨˜éŒ„å®¶åº­æœªä¾† ${yearColumns.length} å¹´å…§çš„é‡è¦æ”¯å‡ºè¦åŠƒ</div>
        <div>2. è«‹æ ¹æ“šå®¶åº­æˆå“¡çš„å¹´é½¡å¢é•·ï¼Œè¦åŠƒå„å¹´åº¦å¯èƒ½çš„é‡å¤§æ”¯å‡º</div>
        <div>3. æ”¯å‡ºé …ç›®åŒ…æ‹¬ä½†ä¸é™æ–¼ï¼šæ•™è‚²è²»ç”¨ã€çµå©šè²»ç”¨ã€è³¼å±‹è²»ç”¨ã€é†«ç™‚è²»ç”¨ç­‰</div>
        <div>4. é‡‘é¡å–®ä½ç‚ºæ–°å°å¹£ï¼ˆå…ƒï¼‰ï¼Œå¯ä¾å¯¦éš›éœ€æ±‚èª¿æ•´</div>
        <div>5. å»ºè­°æ¯å¹´æª¢è¦–ä¸¦æ›´æ–°æ­¤è¦åŠƒè¡¨</div>
    </div>

    <div class="notes">
        <div class="notes-title">ç›®å‰è¦åŠƒé …ç›®æ˜ç´°ï¼š</div>`;

            // æ·»åŠ è©³ç´°é …ç›®èªªæ˜
            Object.entries(groupedExpenses).forEach(([memberId, expenses]) => {
                const member = familyMembers.find(m => m.id === memberId);
                if (!member) return;

                htmlContent += `
        <div style="margin: 15px 0;">
            <strong>${member.name} (${member.currentAge}æ­²)ï¼š</strong>
            <ul style="margin: 5px 0; padding-left: 20px;">`;

                expenses.forEach(expense => {
                    const yearsFromNow = Math.max(0, expense.targetAge - member.currentAge);
                    const targetYear = currentYear + yearsFromNow;
                    htmlContent += `
                <li>${expense.item} - ${targetYear}å¹´ (${expense.targetAge}æ­²) - ${expense.amount.toLocaleString()}å…ƒ
                    ${expense.description ? ` - ${expense.description}` : ''}
                </li>`;
                });

                htmlContent += `
            </ul>
        </div>`;
            });

            htmlContent += `
    </div>

    <div class="footer">
        <p>å ±å‘Šç”¢ç”Ÿæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
        <p>å®¶åº­æœªä¾†æ”¯å‡ºè¦åŠƒç³»çµ± - è®“ç†è²¡è¦åŠƒæ›´ç°¡å–®</p>
    </div>
</body>
</html>`;

            // å»ºç«‹ä¸¦ä¸‹è¼‰æª”æ¡ˆ
            const blob = new Blob([htmlContent], { type: 'application/msword;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `æœªä¾†å®¶åº­æ”¯å‡ºç›¤é»è¡¨_${new Date().toISOString().split('T')[0]}.doc`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            alert('Word å ±å‘Šå·²æˆåŠŸåŒ¯å‡ºï¼');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderFamilyMembers();
            renderFutureExpenses();
            updateSummary();
        });
    </script>
</body>
</html>
